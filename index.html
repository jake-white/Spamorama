<html>
<title id = "title">Spamorama!</title>
<div id = "header">
Spamorama
</div>
<script type="text/javascript" src="unit.js"></script>
<script type="text/javascript" src="upgrade.js"></script>
<link rel="stylesheet" type="text/css" href="style.css">
<div class = container>
<div class = "column-left">
<input type = "image" src = "images/button.png" onclick = "send();"><br>
<body onload = "start();">
Cash = $<label id = "cash" ></label><br>
Spam/second x Gullibility = Cash/second<br>
Cash/second = $<label id = "cps"></label>/second<br>
Spam/second = <label id = "sps"></label> emails/second<br>
Gullibility = <label id = "g"></label>%<br>
<div id = "unitDiv"></div>
</body>
</div>
<div class = "column-center">
Upgrades:<br>
Cost: $<label id = "upgradecost">?</label><br>
<label id = "description">Hover over an available upgrade to read the description!</label>
<table class = "table1">
	<tr>
		<td>
		<button id = "u0" class = "buttonunavailable" onmouseover = "hover(0, true);" onmouseout = "hover(0, false)" onclick = "buy(0)"></button>
		</td>
		<td>		
		<button id = "u1" class = "buttonunavailable" onmouseover = "hover(1, true);" onmouseout = "hover(1, false)" onclick = "buy(1)"></button>
		</td>
		<td>		
		<button id = "u2" class = "buttonunavailable" onmouseover = "hover(2, true);" onmouseout = "hover(2, false)" onclick = "buy(2)"></button>
		</td>
		<td>		
		<button id = "u3" class = "buttonunavailable" onmouseover = "hover(3, true);" onmouseout = "hover(3, false)" onclick = "buy(3)"></button>
		</td>
	</tr>
	<tr>
		<td>
		<button id = "u4" class = "buttonunavailable" onmouseover = "hover(4, true);" onmouseout = "hover(4, false)" onclick = "buy(4)"></button>
		</td>
		<td>		
		<button id = "u5" class = "buttonunavailable" onmouseover = "hover(5, true);" onmouseout = "hover(5, false)" onclick = "buy(5)"></button>
		</td>
		<td>		
		<button id = "u6" class = "buttonunavailable" onmouseover = "hover(6, true);" onmouseout = "hover(6, false)" onclick = "buy(6)"></button>
		</td>
		<td>		
		<button id = "u7" class = "buttonunavailable" onmouseover = "hover(7, true);" onmouseout = "hover(7, false)" onclick = "buy(7)"></button>
		</td>
	</tr>
	<tr>
		<td>
		<button id = "u8" class = "buttonunavailable" onmouseover = "hover(8, true);" onmouseout = "hover(8, false)" onclick = "buy(8)"></button>
		</td>
		<td>		
		<button id = "u9" class = "buttonunavailable" onmouseover = "hover(9, true);" onmouseout = "hover(9, false)" onclick = "buy(9)"></button>
		</td>
		<td>		
		<button id = "u10" class = "buttonunavailable" onmouseover = "hover(10, true);" onmouseout = "hover(10, false)" onclick = "buy(10)"></button>
		</td>
		<td>		
		<button id = "u11" class = "buttonunavailable" onmouseover = "hover(11, true);" onmouseout = "hover(11, false)" onclick = "buy(11)"></button>
		</td>
	</tr>
</table>
</div>
</div>
<div class = "column-right">
[Right Column]
</div>
<script>
var cash = 0;
var cps = 0, sps = 0, g = 0.5; //cash/sec, spam/sec, gullibility
var cpsText = document.getElementById('cps'), spsText = document.getElementById('sps'), gText = document.getElementById('g'), cashText = document.getElementById('cash');
var tickTime = 10;
var array;; //empty array for numbers of objects
var upgrades = new Array(12); //array of Upgrade Objects
var modifier = 0.5; //modifier to exponentially change the cost.  NewCost = [(Amount+2)^(UnitID+2)]*modifier
var lastTime
var button, totalElem;
var start = function()
{
	declareArrays();
	createDynamicElements();
	interval = setInterval(tick, tickTime); //creating a tick interval
	for(var i = 0; i < array.length; ++i)
	{
		array[i] = 0;
	}
	for(var i = 0; i < upgrades.length; ++i)
	{
		upgrades[i] = new Upgrade(i, upgrade.cost[i]);
	}
	window.onfocus = Focus;
	window.onblur = Blur;
}
var createDynamicElements = function() //creating dynamic buttons and text nodes based off of "unit.js"
{	
	var unitDiv = document.getElementById('unitDiv');
	for(var i = 0; i < unit.name.length; ++i)
	{
		button[i] = document.createElement("button");
		buttonText = document.createTextNode(array[i] + " " + unit.name[i] + ": $" + unit.cost[i].toFixed(2));
		button[i].appendChild(buttonText);
		button[i].setAttribute('onclick', 'add('+i+')');
		unitDiv.appendChild(button[i]);
		unitDiv.appendChild(document.createElement('br'));
		unitDiv.appendChild(document.createTextNode(unit.description[i]));
		unitDiv.appendChild(document.createElement('br'));
		unitDiv.appendChild(document.createTextNode("Spam/second per unit = " + unit.output[i]));
		unitDiv.appendChild(document.createElement('br'));
		totalElem[i] = document.createTextNode("Total spam/second of all units = " + unit.output[i] * array[i]);
		unitDiv.appendChild(totalElem[i]);
		unitDiv.appendChild(document.createElement('br'));
	}
	for(var i = 0; i < upgrade.name.length; ++i)
	{
		document.getElementById('u'+i).innerHTML = upgrade.name[i];
	}
}
var declareArrays = function()
{
	array = new Array(unit.name.length);
	button = new Array(unit.name.length);
	totalElem = new Array(unit.name.length);
	upgrades = new Array(upgrade.cost.length);
}
var tick = function()
{
	calcSPS();
	spam();
	setTexts();
}
var spam = function()
{
	//adding up cash by tickTime, so not a full second. maths needed :o
	cash += cps/(1000/tickTime); //cash per tickTime, incorporating gullibility.
}
var send = function()
{
	cash += g; //every human click gives G amount of dollars (temporary?)
}
var add = function(a)
{	
	if(cash >= unit.cost[a]) //checking for enough cash
	{
		cash-= unit.cost[a];
		array[a] += 1;
		unit.cost[a] += (modifier * Math.pow(array[a] + 2, a + 2)); //calculate new cost after buying the unit
	}
}
var calcSPS = function()
{
	sps = 0;
	for(var i = 0; i < array.length; ++i)
	{
		sps += array[i]*unit.output[i];
	}
	cps = sps*g;
}
var hover = function(buttonNumber, on)
{
	if(on)
	{
		document.getElementById('upgradecost').innerHTML = upgrade.cost[buttonNumber];
		document.getElementById('description').innerHTML = upgrade.description[buttonNumber];
	}
	if(!on)
	{
		document.getElementById('upgradecost').innerHTML = "?"
		document.getElementById('description').innerHTML = "Hover over an available upgrade to read the description!";
	}
}
var buy = function(buttonNumber)
{
	upgrades[buttonNumber].buy();
}
var setTexts = function()
{	
	cpsText.innerHTML = cps;
	spsText.innerHTML = sps;
	gText.innerHTML = g * 100;
	cashText.innerHTML = cash.toFixed(2);
	if(cps > 0)
	document.getElementById('title').innerHTML = "$" + cps + "/second!";
	for(var i = 0; i < array.length; ++i) //changing unit buttons/text nodes
	{
		button[i].innerHTML = array[i] + " " + unit.name[i] + ": $" + unit.cost[i].toFixed(2);
		totalElem[i].nodeValue = "Total spam/second of all units = " + unit.output[i] * array[i]; //text nodes require nodeValue, apparently
	}
	for(var i = 0; i < upgrade.cost[i]; ++i)
	{
		var element = document.getElementById("u"+i);
		if(upgrades[i].getBought())
		{
			element.disabled = true;
			element.className = "buttonbought";
		}
		else if(upgrades[i].getAvailable())
		{
			element.disabled = false;
			element.className = "buttonavailable";
		}
		else
		{
			element.disabled = true;
			element.className = "buttonunavailable";
		}
	}
}

//detecting window activity
var Focus = function()
{
	var difference = new Date().getTime() - lastTime;
	cash += cps * (difference/1000);
	interval = setInterval(tick, 10);
}
var Blur = function()
{
	clearInterval(interval);
	lastTime = new Date().getTime();
}

function Upgrade(upgradeNumber, cost) //upgrades go case-by-case to change amounts and modifiers
{
	this.bought = false;
	this.buy = function()
	{
		hover(upgradeNumber, false);
		cash -= cost;
		switch(upgradeNumber) //each upgrade uses switch-case for its effects
		{
			case 0:
				unit.output[0] *=2; //doubles manual labor amount
				break;
			case 1:
				g *= 1.5; //increases gullibility by 50%
				break;
			case 2:
				g *= 1.5; //increases gullibility by 50%
				break;
			case 3:
				unit.output[4]*=2;
				break;
		}
		this.bought = true;
	}
	this.getBought = function()
	{
		return this.bought;
	}
	this.getAvailable = function()
	{
		if(cash >= cost )
		{
			return true;
		}
		return false;
	}
}
</script>
</html>